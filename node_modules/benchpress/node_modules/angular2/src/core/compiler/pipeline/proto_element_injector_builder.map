{"version":3,"sources":["proto_element_injector_builder.js","@traceur/generated/TemplateParser/21","@traceur/generated/TemplateParser/19","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/20","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/189","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/8"],"names":[],"mappings":"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","file":"/Users/tbosch/projects/angular2/modules/angular2/src/core/compiler/pipeline/proto_element_injector_builder.js","sourceRoot":"/Users/tbosch/projects/angular2/modules/angular2/src/core/compiler/pipeline/","sourcesContent":["import {isPresent, isBlank} from 'angular2/src/facade/lang';\nimport {ListWrapper, MapWrapper} from 'angular2/src/facade/collection';\n\nimport {ProtoElementInjector, ComponentKeyMetaData, DirectiveBinding} from '../element_injector';\n\nimport {CompileStep} from './compile_step';\nimport {CompileElement} from './compile_element';\nimport {CompileControl} from './compile_control';\nimport {DirectiveMetadata} from '../directive_metadata';\n\n/**\n * Creates the ProtoElementInjectors.\n *\n * Fills:\n * - CompileElement#inheritedProtoElementInjector\n * - CompileElement#distanceToParentInjector\n *\n * Reads:\n * - (in parent) CompileElement#inheritedProtoElementInjector\n * - (in parent) CompileElement#distanceToParentInjector\n * - CompileElement#isViewRoot\n * - CompileElement#inheritedProtoView\n * - CompileElement#decoratorDirectives\n * - CompileElement#componentDirective\n * - CompileElement#viewportDirective\n */\nexport class ProtoElementInjectorBuilder extends CompileStep {\n  // public so that we can overwrite it in tests\n  internalCreateProtoElementInjector(parent, index, directives, firstBindingIsComponent, distance) {\n    return new ProtoElementInjector(parent, index, directives, firstBindingIsComponent, distance);\n  }\n\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    var distanceToParentInjector = this._getDistanceToParentInjector(parent, current);\n    var parentProtoElementInjector = this._getParentProtoElementInjector(parent, current);\n    var injectorBindings = ListWrapper.map(current.getAllDirectives(), this._createBinding);\n    // TODO: add lightDomServices as well,\n    // but after the directives as we rely on that order\n    // in the element_binder_builder.\n\n    // Create a protoElementInjector for any element that either has bindings *or* has one\n    // or more var- defined. Elements with a var- defined need a their own element injector\n    // so that, when hydrating, $implicit can be set to the element.\n    if (injectorBindings.length > 0 || isPresent(current.variableBindings)) {\n      var protoView = current.inheritedProtoView;\n      var hasComponent = isPresent(current.componentDirective);\n\n      current.inheritedProtoElementInjector = this.internalCreateProtoElementInjector(\n        parentProtoElementInjector, protoView.elementBinders.length, injectorBindings,\n        hasComponent, distanceToParentInjector\n      );\n      current.distanceToParentInjector = 0;\n\n      // Viewport directives are treated differently than other element with var- definitions.\n      if (isPresent(current.variableBindings) && !isPresent(current.viewportDirective)) {\n        current.inheritedProtoElementInjector.exportComponent = hasComponent;\n        current.inheritedProtoElementInjector.exportElement = !hasComponent;\n\n        // experiment\n        var exportImplicitName = MapWrapper.get(current.variableBindings, '\\$implicit');\n        if (isPresent(exportImplicitName)) {\n          current.inheritedProtoElementInjector.exportImplicitName = exportImplicitName;\n        }\n      }\n\n    } else {\n      current.inheritedProtoElementInjector = parentProtoElementInjector;\n      current.distanceToParentInjector = distanceToParentInjector;\n    }\n  }\n\n  _getDistanceToParentInjector(parent, current) {\n    return isPresent(parent) ? parent.distanceToParentInjector + 1 : 0;\n  }\n\n  _getParentProtoElementInjector(parent, current) {\n    if (isPresent(parent) && !current.isViewRoot) {\n      return parent.inheritedProtoElementInjector;\n    }\n    return null;\n  }\n\n  _createBinding(d:DirectiveMetadata): DirectiveBinding {\n    return DirectiveBinding.createFromType(d.type, d.annotation);\n  }\n}\n","Object.defineProperties(module.exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","var __moduleName = $__placeholder__0;","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","var $__placeholder__0 = $__placeholder__1","$traceurRuntime.superConstructor(\n          $__placeholder__0).apply(this, arguments)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","assert.argumentTypes($__placeholder__0)","return assert.returnType(($__placeholder__0), $__placeholder__1)","Object.defineProperty($__placeholder__0, $__placeholder__1,\n        {get: function() {return $__placeholder__2}});"]}