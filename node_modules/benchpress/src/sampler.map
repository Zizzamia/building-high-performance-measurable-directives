{"version":3,"sources":["sampler.js","@traceur/generated/TemplateParser/21","@traceur/generated/TemplateParser/19","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/20","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/25","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/9"],"names":[],"mappings":"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","file":"/Users/tbosch/projects/angular2/modules/benchpress/src/sampler.js","sourceRoot":"/Users/tbosch/projects/angular2/modules/benchpress/src/","sourcesContent":["import { isPresent, isBlank, Date, DateWrapper } from 'angular2/src/facade/lang';\nimport { Promise, PromiseWrapper } from 'angular2/src/facade/async';\nimport { StringMapWrapper, StringMap, List, ListWrapper } from 'angular2/src/facade/collection';\nimport { bind, OpaqueToken } from 'angular2/di';\n\nimport { Metric } from './metric';\nimport { Validator } from './validator';\nimport { Reporter } from './reporter';\nimport { WebDriverExtension } from './web_driver_extension';\nimport { WebDriverAdapter } from './web_driver_adapter';\n\nimport { Options } from './sample_options';\nimport { MeasureValues} from './measure_values';\n\n/**\n * The Sampler owns the sample loop:\n * 1. calls the prepare/execute callbacks,\n * 2. gets data from the metric\n * 3. asks the validator for a valid sample\n * 4. reports the new data to the reporter\n * 5. loop until there is a valid sample\n */\nexport class Sampler {\n  // TODO(tbosch): use static values when our transpiler supports them\n  static get BINDINGS() { return _BINDINGS; }\n  // TODO(tbosch): use static values when our transpiler supports them\n  static get TIME() { return _TIME; }\n\n  _driver:WebDriverAdapter;\n  _driverExtension:WebDriverExtension;\n  _metric:Metric;\n  _reporter:Reporter;\n  _validator:Validator;\n  _forceGc:boolean;\n  _prepare:Function;\n  _execute:Function;\n  _time:Function;\n\n  constructor({\n    driver, driverExtension, metric, reporter, validator, forceGc, prepare, execute, time\n  }:{\n    driver: WebDriverAdapter,\n    driverExtension: WebDriverExtension, metric: Metric, reporter: Reporter,\n    validator: Validator, prepare: Function, execute: Function, time: Function\n  }={}) {\n    this._driver = driver;\n    this._driverExtension = driverExtension;\n    this._metric = metric;\n    this._reporter = reporter;\n    this._validator = validator;\n    this._forceGc = forceGc;\n    this._prepare = prepare;\n    this._execute = execute;\n    this._time = time;\n  }\n\n  sample():Promise<SampleState> {\n    var loop;\n    loop = (lastState) => {\n      return this._iterate(lastState)\n        .then( (newState) => {\n          if (isPresent(newState.validSample)) {\n            return newState;\n          } else {\n            return loop(newState);\n          }\n        });\n    }\n    return this._gcIfNeeded().then( (_) => loop(new SampleState([], null)) );\n  }\n\n  _gcIfNeeded() {\n    if (this._forceGc) {\n      return this._driverExtension.gc();\n    } else {\n      return PromiseWrapper.resolve(null);\n    }\n  }\n\n  _iterate(lastState) {\n    var resultPromise;\n    if (isPresent(this._prepare)) {\n      resultPromise = this._driver.waitFor(this._prepare)\n        .then( (_) => this._gcIfNeeded() );\n    } else {\n      resultPromise = PromiseWrapper.resolve(null);\n    }\n    if (isPresent(this._prepare) || lastState.completeSample.length === 0) {\n      resultPromise = resultPromise.then( (_) => this._metric.beginMeasure() );\n    }\n    return resultPromise\n      .then( (_) => this._driver.waitFor(this._execute) )\n      .then( (_) => this._gcIfNeeded() )\n      .then( (_) => this._metric.endMeasure(isBlank(this._prepare)) )\n      .then( (measureValues) => this._report(lastState, measureValues) );\n  }\n\n  _report(state:SampleState, metricValues:StringMap):Promise<SampleState> {\n    var measureValues = new MeasureValues(state.completeSample.length, this._time(), metricValues);\n    var completeSample = ListWrapper.concat(state.completeSample, [measureValues]);\n    var validSample = this._validator.validate(completeSample);\n    var resultPromise = this._reporter.reportMeasureValues(measureValues);\n    if (isPresent(validSample)) {\n      resultPromise = resultPromise.then( (_) => this._reporter.reportSample(completeSample, validSample) )\n    }\n    return resultPromise.then( (_) => new SampleState(completeSample, validSample) );\n  }\n\n}\n\nexport class SampleState {\n  completeSample:List;\n  validSample:List;\n\n  constructor(completeSample: List, validSample: List) {\n    this.completeSample = completeSample;\n    this.validSample = validSample;\n  }\n}\n\nvar _TIME = new OpaqueToken('Sampler.time');\n\nvar _BINDINGS = [\n  bind(Sampler).toFactory(\n    (driver, driverExtension, metric, reporter, validator, forceGc, prepare, execute, time) => new Sampler({\n      driver: driver,\n      driverExtension: driverExtension,\n      reporter: reporter,\n      validator: validator,\n      metric: metric,\n      forceGc: forceGc,\n      // TODO(tbosch): DI right now does not support null/undefined objects\n      // Mostly because the cache would have to be initialized with a\n      // special null object, which is expensive.\n      prepare: prepare !== false ? prepare : null,\n      execute: execute,\n      time: time\n    }),\n    [WebDriverAdapter, WebDriverExtension, Metric, Reporter, Validator, Options.FORCE_GC, Options.PREPARE, Options.EXECUTE, _TIME]\n  ),\n  bind(Options.FORCE_GC).toValue(false),\n  bind(Options.PREPARE).toValue(false),\n  bind(_TIME).toValue( () => DateWrapper.now() )\n];\n","Object.defineProperties(module.exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","var __moduleName = $__placeholder__0;","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2)","return assert.returnType(($__placeholder__0), $__placeholder__1)","assert.genericType($__placeholder__0)","Object.defineProperty($__placeholder__0, $__placeholder__1,\n        {get: function() {return $__placeholder__2}});","assert.argumentTypes($__placeholder__0)"]}